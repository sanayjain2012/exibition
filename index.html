<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Integers — Interactive Exhibition (Ark Mode) — Debug Build (Fixed)</title>
  <style>
    :root{--accent:#ffd24d;--muted:#c7d6ef}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#041026;color:#e6f0fb}
    body{display:flex}
    #sidebar{width:260px;background:rgba(255,255,255,0.03);padding:18px;border-right:1px solid rgba(255,255,255,0.03)}
    #nav a{display:block;color:var(--muted);padding:10px 12px;text-decoration:none}
    #nav a.active{color:var(--accent);font-weight:700}
    #main{flex:1;padding:24px;overflow:auto;height:100vh}
    .card{background:rgba(255,255,255,0.03);padding:14px;border-radius:10px;margin-bottom:12px}
    .muted-block{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;color:var(--muted)}
    /* canvas initially hidden — we show it when running animations */
    #overlayCanvas{position:fixed;inset:0;width:100%;height:100%;z-index:9999;pointer-events:none;display:none}
    button{cursor:pointer}
    input{padding:8px;border-radius:6px}
  </style>
</head>
<body>
  <div id="sidebar">
    <div style="font-weight:700;margin-bottom:10px">Menu</div>
    <nav id="nav">
      <a href="#how" data-page="how" class="active">How to Use</a>
      <a href="#uses" data-page="uses">Uses</a>
      <a href="#india" data-page="india">India</a>
      <a href="#basics" data-page="basics">Basics</a>
      <a href="#easter" data-page="easter">Easter Egg</a>
    </nav>
  </div>

  <div id="main">
    <section id="how" class="page active"><div class="card"><h2>How to use</h2><p class="muted-block">Use left menu. This debug build logs to console to help diagnose issues.</p></div></section>
    <section id="easter" class="page"><div class="card"><h2>Easter Egg (Debug)</h2>
      <p class="muted-block">Enter secret code, then answer question. Console will print helpful logs.</p>

      <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
        <label for="secretCodeInput">Secret Code:</label>
        <input id="secretCodeInput" placeholder="101" />
        <button id="secretSubmit">Enter</button>
        <div id="secretMsg" class="muted-block" style="margin-left:8px"></div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="unlockBtn" disabled>Unlock</button>
        <button id="newQBtn" disabled>New Question</button>
      </div>

      <div id="challenge" style="margin-top:12px;display:none">
        <div class="card">
          <div id="qText" style="font-weight:700"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="answerInput" placeholder="answer" />
            <button id="submitAnswer">Submit</button>
          </div>
          <div id="fb" class="muted-block" style="margin-top:8px"></div>
        </div>
      </div>
    </div></section>

  </div>

  <canvas id="overlayCanvas"></canvas>

  <script>
    // Debug-friendly robust initialization
    console.log('Debug build starting...');
    (function(){
      // elements
      const links = document.querySelectorAll('#nav a');
      const pages = document.querySelectorAll('.page');
      links.forEach(link=>{
        link.addEventListener('click', e=>{
          e.preventDefault();
          const page = link.dataset.page;
          console.log('nav click', page);
          document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
          const target = document.getElementById(page);
          if(target){ target.classList.add('active'); }
          links.forEach(l=>l.classList.remove('active'));
          link.classList.add('active');
        });
      });

      // Easter elements
      const secretInput = document.getElementById('secretCodeInput');
      const secretSubmit = document.getElementById('secretSubmit');
      const secretMsg = document.getElementById('secretMsg');
      const unlockBtn = document.getElementById('unlockBtn');
      const newQBtn = document.getElementById('newQBtn');
      const challengeDiv = document.getElementById('challenge');
      const qText = document.getElementById('qText');
      const answerInput = document.getElementById('answerInput');
      const submitAnswer = document.getElementById('submitAnswer');
      const fb = document.getElementById('fb');
      const overlayCanvas = document.getElementById('overlayCanvas');

      if(!overlayCanvas){ console.error('overlayCanvas missing'); }

      const pool = [
        {id:'101', q:'What is -7 + 12?', a:'5'},
        {id:'202', q:'Which is an integer: 3.14, -8, √2?', a:'-8'},
        {id:'303', q:'What is (-2)*(-2)?', a:'4'},
        {id:'404', q:'If you subtract -5 from 2 what is the result?', a:'7'},
        {id:'505', q:'Integer division 7 ÷ 3 (truncate) = ?', a:'2'}
      ];

      function validCode(code){ return ['101','202','303','404','505'].includes(code); }
      function pickQuestionFor(code){ const list = pool.filter(x=>x.id===code); if(!list.length) return null; return list[Math.floor(Math.random()*list.length)]; }

      let current=null; let currentCode=null;

      secretSubmit.addEventListener('click', ()=>{
        const val = (secretInput.value||'').trim(); console.log('secret entered:',val);
        if(!validCode(val)){ secretMsg.textContent='Invalid'; secretMsg.style.color='#ff7b7b'; unlockBtn.disabled=true; newQBtn.disabled=true; challengeDiv.style.display='none'; current=null; currentCode=null; return; }
        secretMsg.textContent='Accepted'; secretMsg.style.color='var(--accent)'; currentCode=val; unlockBtn.disabled=false; newQBtn.disabled=false; current=pickQuestionFor(currentCode); if(current){ showChallenge(); triggerAnimation(currentCode); }
      });

      unlockBtn.addEventListener('click', ()=>{ if(!currentCode) return; current=pickQuestionFor(currentCode); if(current) { showChallenge(); triggerAnimation(currentCode); } });
      newQBtn.addEventListener('click', ()=>{ if(!currentCode) return; current=pickQuestionFor(currentCode); if(current) { showChallenge(); triggerAnimation(currentCode); } });

      function showChallenge(){ if(!current) return; challengeDiv.style.display='block'; qText.textContent=current.q; answerInput.value=''; fb.textContent=''; }

      submitAnswer.addEventListener('click', ()=>{
        const ans=(answerInput.value||'').trim(); console.log('submit answer',ans,'expected',current?current.a:null);
        if(!current){ fb.textContent='No question active'; fb.style.color='#ff7b7b'; return; }
        if(ans.toLowerCase()===current.a.toLowerCase()){ fb.textContent='Correct ✅'; fb.style.color='#9be66c'; triggerAnimation(currentCode,'correct'); } else { fb.textContent='Incorrect ❌'; fb.style.color='#ff7b7b'; triggerAnimation(currentCode,'wrong'); }
      });

      // canvas setup
      const ctx = overlayCanvas.getContext? overlayCanvas.getContext('2d') : null;
      let W=0,H=0;
      function resize(){ if(!overlayCanvas) return; W=overlayCanvas.width=overlayCanvas.clientWidth; H=overlayCanvas.height=overlayCanvas.clientHeight; }
      window.addEventListener('resize', resize);
      // NOTE: do not rely on canvas client size while hidden; resize() will be called again when showing it
      resize();
      let animFrame=null, stopTimeout=null;
      function clearAnim(){ if(animFrame) cancelAnimationFrame(animFrame); animFrame=null; if(stopTimeout) clearTimeout(stopTimeout); stopTimeout=null; if(ctx) ctx.clearRect(0,0,W,H); overlayCanvas.style.display='none'; }

      function triggerAnimation(code,state){ console.log('triggerAnimation',code,state);
        if(!code) return;
        // clear previous animation first
        clearAnim();
        // show canvas, then resize so width/height are correct
        overlayCanvas.style.display='block';
        resize(); // <<< IMPORTANT FIX: set canvas size AFTER making it visible
        // start selected animation
        if(code==='101') animBurst();
        if(code==='202') animConfetti();
        if(code==='303') animNumberRain();
        if(code==='404') animGlitch();
        if(code==='505') animOrbit();
        // stop after 5s
        stopTimeout = setTimeout(()=>{ clearAnim(); console.log('animation stopped'); },5000);
      }

      // animations (simple, safe)
      function animBurst(){ if(!ctx) return; const parts=[]; for(let i=0;i<160;i++){ parts.push({x:W/2,y:H/2,vx:(Math.random()-0.5)*12,vy:(Math.random()-0.5)*12,r:Math.random()*4+1,life:Math.random()*100+40,age:0}); }
        function loop(){ ctx.clearRect(0,0,W,H); for(const p of parts){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.12; p.age++; ctx.globalAlpha=Math.max(0,1-p.age/p.life); ctx.fillStyle='rgba(255,210,77,'+ctx.globalAlpha+')'; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); } animFrame=requestAnimationFrame(loop); }
        loop(); }

      function animConfetti(){ if(!ctx) return; const conf=[]; const cols=['#ffd24d','#66d9ff','#ff8fb3','#9be66c']; for(let i=0;i<120;i++){ conf.push({x:Math.random()*W,y:Math.random()*-H,vy:Math.random()*1.6+0.6,w:Math.random()*12+6,col:cols[Math.floor(Math.random()*cols.length)],rot:Math.random()*Math.PI}); }
        function loop(){ ctx.clearRect(0,0,W,H); for(const c of conf){ c.y+=c.vy; c.x+=Math.sin(c.y/60)*0.6; ctx.save(); ctx.translate(c.x,c.y); ctx.rotate(c.rot); ctx.fillStyle=c.col; ctx.fillRect(-c.w/2,-c.w/2,c.w,c.w*1.4); ctx.restore(); if(c.y>H+40){ c.y=-40; c.x=Math.random()*W; } } animFrame=requestAnimationFrame(loop); }
        loop(); }

      function animNumberRain(){ if(!ctx) return; const chars=['0','1','2','3','4','5','6','7','8','9','-']; const drops=[]; for(let i=0;i<Math.floor(W/12);i++) drops.push({x:i*12+Math.random()*12,y:Math.random()*-H,vy:Math.random()*4+2});
        function loop(){ ctx.fillStyle='rgba(0,0,0,0.08)'; ctx.fillRect(0,0,W,H); ctx.font='16px monospace'; ctx.fillStyle='rgba(255,255,255,0.9)'; for(const d of drops){ d.y+=d.vy; const ch=chars[Math.floor(Math.random()*chars.length)]; ctx.fillText(ch,d.x,d.y); if(d.y>H+20) d.y=Math.random()*-100; } animFrame=requestAnimationFrame(loop); }
        loop(); }

      function animGlitch(){ if(!ctx) return; let t=0; function loop(){ ctx.clearRect(0,0,W,H); const g=ctx.createLinearGradient(0,0,W,H); g.addColorStop(0,'#051421'); g.addColorStop(1,'#0b1430'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H); ctx.font='120px serif'; ctx.textAlign='center'; ctx.fillStyle='rgba(255,210,77,0.16)'; ctx.fillText('ERROR',W/2+Math.sin(t/10)*8,H/2+Math.cos(t/8)*8); t+=1; animFrame=requestAnimationFrame(loop); } loop(); }

      function animOrbit(){ if(!ctx) return; const objs=[]; const cx=W/2,cy=H/2; for(let i=0;i<12;i++) objs.push({angle:Math.random()*Math.PI*2,r:80+i*20,speed:0.01+i*0.002,val:(i%2?i:-i)});
        function loop(){ ctx.fillStyle='rgba(0,0,0,0.08)'; ctx.fillRect(0,0,W,H); ctx.font='20px monospace'; ctx.textAlign='center'; for(const o of objs){ o.angle+=o.speed; const x=cx+Math.cos(o.angle)*o.r; const y=cy+Math.sin(o.angle)*o.r; ctx.fillStyle='rgba(255,255,255,0.95)'; ctx.fillText(o.val,x,y); } animFrame=requestAnimationFrame(loop); } loop(); }

      console.log('Debug init complete');
    })();
  </script>
</body>
</html>

